<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>Flutter & GitHub Workflows: Deploying to TestFlight - Jørgen's Blog</title>
  <meta name="author" content="Jørgen Tjernø">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://jorgen.tjer.no/post/2022/02/26/flutter-github-workflows-and-testflight/">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Jørgen's Blog" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://jorgen.tjer.no/post/2022/02/26/flutter-github-workflows-and-testflight/">
  <meta property="og:title" content="Flutter & GitHub Workflows: Deploying to TestFlight - Jørgen's Blog">
  

  <script src="/javascripts/libs/jquery/jquery-2.1.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">

<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">


  
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-51279149-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Jørgen's Blog</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                <li>
                    <a href="https://twitter.com/jorgenpt"><i class="fa fa-twitter fa-lg"></i></a>
                </li>
                <li>
                    <a href="https://github.com/jorgenpt"><i class="fa fa-github fa-lg"></i></a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="sitesearch" value="jorgen.tjer.no">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="Jørgen's Blog" />
    
    <meta itemprop="url" content="https://jorgen.tjer.no" />
    <article class="hentry" role="article" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2022-02-26T00:00:00-08:00"  data-updated="true" itemprop="datePublished dateCreated">26 Feb, 2022</time>
        
      </p>
    
    
    <h1 class="entry-title" itemprop="name headline">
        Flutter & GitHub Workflows: Deploying to TestFlight
        
    </h1>
    
  </header>


<div class="entry-content clearfix" itemprop="articleBody description"><p>When I wanted my personal <a href="https://flutter.dev/">Flutter</a> app to distribute iOS builds from a <a href="https://docs.github.com/en/actions">GitHub workflow</a> using <a href="https://developer.apple.com/testflight/">TestFlight</a>, I couldn&rsquo;t find a good cohesive guide to setting it up. The process was a bit nuanced and time consuming to get right.</p>

<p>In the end I created a GitHub workflow that automatically publishes whenever I push a versioned tag to GitHub &ndash; it builds the project, signs it, and publishes that build to TestFlight.</p>

<p>Below I&rsquo;ve provided the comprehensive set of steps you need to set this up from scratch, which I reproduced <a href="https://github.com/jorgenpt/flutter_github_example/tree/publish-to-testflight">using a public sample repository for your reference</a>.</p>

<!-- more -->


<a name="Requirements"></a>
<h2>Requirements</h2>

<p>In order to deploy builds to <a href="https://developer.apple.com/testflight/">TestFlight</a>, Apple requires that you have an <a href="https://developer.apple.com/programs/enroll/">Apple Developer Program</a> account &ndash; these cost $99/year.</p>

<p>I&rsquo;m also assuming you&rsquo;ve created a private or public repository on GitHub that you&rsquo;ll be using for version control where you can run the GitHub Workflow we&rsquo;ll set up.</p>

<a name="Setup.with.Apple"></a>
<h2>Setup with Apple</h2>

<p>These are the steps to configure your app in Apple&rsquo;s systems.</p>

<ol>
<li>Create a Bundle ID on <a href="https://developer.apple.com/account/resources/identifiers/add/bundleId">Apple Developer portal</a> &ndash; it can be an arbitrary bundle ID, and it doesn&rsquo;t require any specific Capabilities or App Services. Typically these are reverse-domain names, for my example I used <code>no.tjer.HelloWorld</code>.</li>
<li>Create an iOS App for your Bundle ID in <a href="https://appstoreconnect.apple.com/apps">App Store Connect</a> by clicking the <i class="fa fa-plus-circle" title="circled plus icon"></i> next to <em>Apps</em></li>
<li>Configure TestFlight on <a href="https://appstoreconnect.apple.com/apps">App Store Connect</a>, by navigating to your app and selecting the <em>TestFlight</em> tab.

<ol>
<li>Click the <i class="fa fa-plus-circle" title="circled plus icon"></i> next to <em>Internal Testing</em> to create a new internal group</li>
<li>Name it whatever you&rsquo;d prefer (e.g. Developers)</li>
<li>Click the new group in the sidebar and add yourself by clicking the <i class="fa fa-plus-circle" title="circled plus icon"></i> next to <em>Tester (0)</em></li>
</ol>
</li>
</ol>


<a name="Create..amp..set.up.a.Flutter.project.for.iOS"></a>
<h2>Create &amp; set up a Flutter project for iOS</h2>

<p>First we set up a project with Flutter with the iOS platform enabled and configure the project&rsquo;s Bundle ID</p>

<ol>
<li><p>Create a new Flutter project with iOS enabled, if you haven&rsquo;t already:</p>

<pre><code class="`sh"> flutter create --platforms ios --org no.tjer --project-name hello_world --description "Test for iOS deploy on GH" flutter_github_example
</code></pre></li>
<li>Navigate to your project directory (e.g. <code>flutter_github_example</code> in the above example) and open <code>ios/Runner.xcworkspace</code> in Xcode.</li>
<li>Make sure the Bundle Identifier for the project matches the one you created above by navigating to the Runner project in the left pane, clicking the Runner target, and then updating the <em>Bundle Identifier</em> under the <em>General</em> tab.</li>
</ol>


<a name="Configure.code.signing"></a>
<h2>Configure code signing</h2>

<p>To help managing code signing certificates and provisioning profiles, as well as the process of building &amp; signing, we&rsquo;ll use the excellent open source project <a href="https://fastlane.tools/">fastlane</a>. We&rsquo;ll be using a <strong>private</strong> GH repository to distribute the signing certificate to the builder (and to the team, if wanted).</p>

<a name="Setting.up..code.fastlane..code..for.your.project"></a>
<h3>Setting up <code>fastlane</code> for your project</h3>

<p>Please refer to the <a href="https://docs.fastlane.tools/getting-started/ios/setup/">fastlane setup docs</a> for more details, but here&rsquo;s a quick overview of what to do to configure Fastlane.</p>

<ol>
<li><p>Create a text-file called <code>ios/Gemfile</code> with the following content:</p>

<pre><code class="`rb"> source "https://rubygems.org"

 gem "fastlane"
 gem "cocoapods"
</code></pre></li>
<li><p>From a shell:</p>

<pre><code class="`sh"> brew install rbenv ruby-build # Set up rbenv to control the ruby version
 rbenv init
</code></pre></li>
<li><p>Close your terminal and re-open it for <code>rbenv</code> to be initialized, then navigate to your Flutter project and run:</p>

<pre><code class="`sh"> rbenv install -l 2&gt;&amp;1 | grep '^\d' | sort -n | tail -n 1 &gt; .ruby-version # Pick the most recent stable Ruby -- at the time of writing this is 3.1.1.
 rbenv install # Install the requested version of Ruby
 gem install bundler
 cd ios
 bundle lock --add-platform x86_64-darwin-19 # Make sure the platform list includes the GH Runner platform
 bundle exec fastlane init # Start the initial configuration of fastlane
</code></pre>

<ul>
<li>Choose <em>🚀 Automate App Store distribution</em> when <code>fastlane init</code> prompts you for what you&rsquo;re configuring, and sign in to your Apple Developer account.</li>
</ul>
</li>
<li>Make sure to add the following files to git:

<ul>
<li><code>.ruby-version</code> &ndash; the Ruby version we&rsquo;re using for fastlane</li>
<li><code>ios/fastlane/Appfile</code> &ndash; configuration for the iOS app store</li>
<li><code>ios/fastlane/Fastfile</code> &ndash; where we keep our fastlane recipe</li>
<li><code>ios/Gemfile</code> &ndash; the dependencies for fastlane</li>
<li><code>ios/Gemfile.lock</code> &ndash; specific version informatin for the gems specified in the Gemfile</li>
</ul>
</li>
</ol>


<a name="Configuring.App.Store.Connect.API.access.for.fastlane"></a>
<h3>Configuring App Store Connect API access for fastlane</h3>

<ol>
<li>Set up an App Store Connect API key <a href="https://appstoreconnect.apple.com/access/users">on the <em>Users &amp; Access</em> section of the site</a> by going to the <em>Keys</em> tab and then:

<ol>
<li>Click the <i class="fa fa-plus-circle" title="circled plus icon"></i> next to <em>Active (0)</em>.</li>
<li>Give it an identifying name (E.g. <em>Flutter GH Deploy</em> for the example project</li>
<li>Choose <em>Developer</em> as the Access for the key, and click Generate</li>
</ol>
</li>
<li>Refresh the page (navigating back to <em>Keys</em>) and choose to <em>Download API key</em> on the right side of the newly added key</li>
<li>Add the API key to your GitHub secrets &ndash; this allows GitHub Workflows to publish new TestFlight builds:

<ol>
<li>Navigate to your Flutter project&rsquo;s GitHub page (e.g. <a href="https://github.com/jorgenpt/flutter_github_example/">https://github.com/jorgenpt/flutter_github_example/</a> for my example repo).</li>
<li>Go to Settings, and select Secrets > Actions on the left side.</li>
<li>Add a <em>New repository secret</em> named <code>APP_STORE_CONNECT_API_KEY_KEY</code> (yes, <code>KEY</code> should be there twice) and paste in the contents of the API key file you downloaded from App Store Connect (the file is named something like <code>AuthKey_KEYID.p8</code>).</li>
</ol>
</li>
</ol>


<a name="Configuring.certificates..amp..provisioning.profiles"></a>
<h3>Configuring certificates &amp; provisioning profiles</h3>

<p>First, create a private repository <a href="https://github.com/new">on GitHub</a> and mark it as <em>Private</em>. In my case, I named it <code>certificates</code>. Don&rsquo;t initialize it with any files or licenses. Make a note of the SSH url for your repository, in my case that&rsquo;ll be <code>git@github.com:jorgenpt/certificates</code>.</p>

<ol>
<li><p>Navigate to your Flutter project in a shell and then run these commands:</p>

<pre><code class="`sh"> # These all need to be run from the ios platform of your Flutter project
 cd ios

 # For the following command, give `match init` the SSH URL for your repository (e.g.
 # git@github.com:myuser/certificates) and generate a random password (though make a note
 # of it for the next step).
 # You should add the generated Matchfile to Git.
 bundle exec fastlane match init 

 # Create an appstore distribution certificate &amp; provisioning profile
 bundle exec fastlane match appstore
 # Create a development certificate &amp; provisioning profile
 bundle exec fastlane match development
</code></pre></li>
<li>Make sure that your Xcode project is configured to use the same certificates:

<ol>
<li>Open <code>ios/Runner.xcworkspace</code> in Xcode</li>
<li>Navigate to the Runner project in the left pane, click the Runner target, and switch to the <em>Signing &amp; Capabilities</em> tab.</li>
<li>Uncheck <em>Automatically manage signing</em>.</li>
<li>Select <em>Release</em> in the top bar and set the provisioning profile to the one that starts with <em>match AppStore</em>.</li>
<li>Select <em>Debug</em> in the top bar and set the provisioning profile to the one that starts with <em>match Development</em>, and repeat this for <em>Profile</em> as well.
<img src="/images/flutter-github-testflight-configured-signing.png"></li>
</ol>
</li>
<li><p>Create a new SSH key that your workflow can use to access your GitHub certificates repository:</p>

<pre><code class="`sh"> ssh-keygen -C github.com:myuser/my_flutter_project_name -f ~/Desktop/id_rsa_build
</code></pre></li>
<li><p>Add the password you generated above &amp; the SSH key to your GitHub secrets &ndash; this allows GitHub Workflows to sign your build:</p>

<ol>
<li>Navigate to your Flutter project&rsquo;s GitHub page (e.g. <a href="https://github.com/jorgenpt/flutter_github_example/">https://github.com/jorgenpt/flutter_github_example/</a> for my example repo).</li>
<li>Go to Settings, and select Secrets > Actions on the left side.</li>
<li>Add a <em>New repository secret</em> named <code>MATCH_PASSWORD</code> and paste in the password you generated above.</li>
<li>Add a second <em>New repository secret</em> named <code>SSH_PRIVATE_KEY</code> and paste in the contents of <code>id_rsa_build</code> on your Desktop.</li>
</ol>
</li>
</ol>


<a name="Putting.it.all.together"></a>
<h2>Putting it all together</h2>

<p>Your GitHub repository&rsquo;s secrets should have three different secrets configured:</p>

<p><img src="/images/flutter-github-testflight-configured-secrets.png" width="640"></p>

<p>Now all that remains is to set up a fastlane <em>lane</em> that runs our build for us, and configure GitHub Workflows to invoke it:</p>

<ol>
<li>Create <code>.github/workflows/publish_ios.yml</code> in your Flutter repository from the <a href="https://raw.githubusercontent.com/jorgenpt/flutter_github_example/blogpost-testflight/.github/workflows/publish_ios.yml">reference publish_ios.yml in the example project</a>.</li>
<li>Create <code>ios/fastlane/Fastfile</code> in your Flutter repository from the <a href="https://raw.githubusercontent.com/jorgenpt/flutter_github_example/blogpost-testflight/ios/fastlane/Fastfile">reference Fastfile in the example project</a>.</li>
<li>Update <code>ios/fastlane/Fastfile</code> with your project details:

<ol>
<li><code>APP_IDENTIFIER</code> is the <em>Bundle Identifier</em> we created in <em>Setup with Apple</em>.</li>
<li><code>APPSTORECONNECT_ISSUER_ID</code> is the <em>Issuer ID</em> from the <em>Keys</em> section of <a href="https://appstoreconnect.apple.com/access/users"><em>Users and Access</em> on App Store Connect</a>.</li>
<li><code>APPSTORECONNECT_KEY_ID</code> is the <em>Key ID</em> from the specific key that we created in <em>Configuring App Store Connect API access for fastlane</em>, which you can look up in the <em>Keys</em> section of <a href="https://appstoreconnect.apple.com/access/users"><em>Users and Access</em> on App Store Connect</a>.</li>
</ol>
</li>
</ol>


<p>That&rsquo;s it! Now just create a git tag and push it to GitHub to start a build:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git tag v0.1.0 <span class="c"># This accepts any tag name  starting with &quot;v&quot;</span>
</span><span class='line'>git push --tags
</span></code></pre></td></tr></table></div></figure>


<p>You can see an example run <a href="https://github.com/jorgenpt/flutter_github_example/actions/workflows/publish_ios.yml">in the Actions tab of <code>flutter_github_example</code></a>.</p>

<p>These builds will by default be available to <em>Internal Testers</em> &ndash; you can use the App Store Connect app or website to release one of these builds to <em>External Testers</em>.</p>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person">Posted by <span class="fn" itemprop="name">Jørgen Tjernø</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2022-02-26T00:00:00-08:00"  data-updated="true" itemprop="datePublished dateCreated">26 Feb, 2022</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/flutter/'>flutter</a>, <a class='category' href='/blog/categories/github/'>github</a>, <a class='category' href='/blog/categories/ios/'>ios</a>
  
</span>


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://jorgen.tjer.no/post/2022/02/26/flutter-github-workflows-and-testflight/" data-via="" data-counturl="https://jorgen.tjer.no/post/2022/02/26/flutter-github-workflows-and-testflight/" >Tweet</a>
  
  
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/post/2021/03/13/registering-a-rust-program-as-a-browser-on-windows/" title="Previous Post: Registering a (Rust) program as a browser on Windows">&laquo; Registering a (Rust) program as a browser on Windows</a></li>
            
            
            <li class="next"><a href="/post/2023/03/04/unreal-ci/" title="Next Post: Unreal Engine and Continuous Integration">Unreal Engine and Continuous Integration &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>
    
      <section>
        <h2>Comments</h2>
        <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
      </section>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/post/2023/03/04/unreal-ci/">Unreal Engine and Continuous Integration</a>
    
    <a class="list-group-item active" href="/post/2022/02/26/flutter-github-workflows-and-testflight/">Flutter & GitHub Workflows: Deploying to TestFlight</a>
    
    <a class="list-group-item " href="/post/2021/03/13/registering-a-rust-program-as-a-browser-on-windows/">Registering a (Rust) program as a browser on Windows</a>
    
    <a class="list-group-item " href="/post/2019/01/10/aie-presentation/">AIE presentation slides</a>
    
    <a class="list-group-item " href="/post/2015/10/21/experience-america-presentation/">Experience America presentation slides</a>
    
  </div>
</section>






    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2023 - Jørgen Tjernø<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
  var disqus_shortname = 'jorgenpt';
  
  
  var disqus_config = function () {
    this.page.url = 'https://jorgen.tjer.no/post/2022/02/26/flutter-github-workflows-and-testflight/';
    this.page.identifier = 'https://jorgen.tjer.no/post/2022/02/26/flutter-github-workflows-and-testflight/';
  };
  var disqus_script = 'embed.js';
  
  (function () { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>






  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr.js"></script>


  </body>
</html>
